/*CREATE EMPLOYEE_PROFILE_TABLE*/
CREATE TABLE EMP_PROFILE(
    EMP_ID INT NOT NULL,
    EMP_NO INT NOT NULL,
    EMP_NAME VARCHAR(255),
    IC_NO INT NOT NULL
);

/*ADD PK CONSTRAINT*/
ALTER TABLE EMP_PROFILE
ADD CONSTRAINT PK_EP PRIMARY KEY (EMP_ID);

/*INSERT VALUES TO EMP_PROFILE TABLE*/
INSERT INTO EMP_PROFILE VALUES(1, 1000, 'ALI', 1234);
INSERT INTO EMP_PROFILE VALUES(2, 1001, 'AHMAD', 2345);
INSERT INTO EMP_PROFILE VALUES(3, 1002, 'KOAY', 3456);
INSERT INTO EMP_PROFILE VALUES(4, 1003, 'LAU', 4567);

/*CREATE JOB_PROFILE_TABLE*/
CREATE TABLE JOB_PROFILE(
    JOB_ID INT NOT NULL,
    JOB_NAME VARCHAR(255),
    CONSTRAINT PK_JP PRIMARY KEY (JOB_ID)
);

/*INSERT VALUES TO JOB_PROFILE TABLE*/
INSERT INTO JOB_PROFILE VALUES(1, 'FINANCE');
INSERT INTO JOB_PROFILE VALUES(2, 'DEVELOPER');
INSERT INTO JOB_PROFILE VALUES(3, 'ADMIN');
INSERT INTO JOB_PROFILE VALUES(4, 'SENIOR DEVELOPER');

/*CREATE EMPLOYEE_JOB_TABLE*/
CREATE TABLE EMP_JOB(
    EFFECTIVE_DATE DATE NOT NULL,
    E_ID INT NOT NULL,
    J_ID INT NOT NULL
);

/*ADD A ROW*/
ALTER TABLE EMP_JOB
ADD EMP_ID INT NOT NULL;

/*ADD A ROW*/
ALTER TABLE EMP_JOB
ADD J_ID INT NOT NULL;


/*CREATE FOREIGN KEY EMP_ID*/
ALTER TABLE EMP_JOB
ADD CONSTRAINT FK_EMP_ID
FOREIGN KEY (E_ID) REFERENCES EMP_PROFILE(EMP_ID);

/*CREATE FOREIGN KEY JOB_ID*/
ALTER TABLE EMP_JOB
ADD CONSTRAINT FK_JOB_ID
FOREIGN KEY (J_ID) REFERENCES JOB_PROFILE(JOB_ID);

/*INSERT VALUES TO EMP_JOB TABLE*/
INSERT INTO EMP_JOB (E_ID, J_ID, EFFECTIVE_DATE) VALUES (1, 2, TO_DATE('2019-01-01', 'YYYY-MM-DD'));
INSERT INTO EMP_JOB (E_ID, J_ID, EFFECTIVE_DATE) VALUES (1, 4, TO_DATE('2020-01-01', 'YYYY-MM-DD'));
INSERT INTO EMP_JOB (E_ID, J_ID, EFFECTIVE_DATE) VALUES (3, 3, TO_DATE('2018-01-01', 'YYYY-MM-DD'));
INSERT INTO EMP_JOB (E_ID, J_ID, EFFECTIVE_DATE) VALUES (3, 3, TO_DATE('2017-05-14', 'YYYY-MM-DD'));
INSERT INTO EMP_JOB (E_ID, J_ID, EFFECTIVE_DATE) VALUES (4, 1, TO_DATE('2019-06-09', 'YYYY-MM-DD'));

/*
Q2.a
update the employee with employee_no 1002 job to 4, with effective 2020-01-01.
*/
--SELECT EMP_ID, EMP_NO, JOB_ID, EFFECTIVE_DATE
--FROM EMP_PROFILE
--JOIN EMP_JOB ON EMP_NO = 1002;
UPDATE EMP_JOB
SET J_ID = 4, EFFECTIVE_DATE = TO_DATE('2020-01-01', 'YYYY-MM-DD') WHERE E_ID = 3;

/*
Q2.b
list out the employee name, employee no, effective date, job title.
*/
SELECT EMP_PROFILE.EMP_NAME, EMP_PROFILE.EMP_NO, EFFECTIVE_DATE, JOB_PROFILE.JOB_NAME
FROM EMP_JOB
JOIN EMP_PROFILE ON EMP_JOB.E_ID = EMP_PROFILE.EMP_ID
JOIN JOB_PROFILE ON EMP_JOB.J_ID = JOB_PROFILE.JOB_ID;

/*
Q2.c
list out the employee name, employee no, latest job title
*/
SELECT EMP_PROFILE.EMP_NAME, EMP_PROFILE.EMP_NO, JOB_PROFILE.JOB_NAME
FROM EMP_JOB
JOIN EMP_PROFILE ON EMP_JOB.E_ID = EMP_PROFILE.EMP_ID
JOIN JOB_PROFILE ON EMP_JOB.J_ID = JOB_PROFILE.JOB_ID;

/*
Q2.d
delete all employee with employee_no 1000 job title, with effective date of 2020-01-01
*/
DELETE 
FROM EMP_JOB
WHERE
E_ID = 1 OR
EFFECTIVE_DATE = '01-01-2020';



/*COMMIT CHANGES*/
COMMIT;